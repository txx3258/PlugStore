<%- include _header %>

<link href="<%= staticResourceUrl %>/css/tablednd.css" rel="stylesheet">
<style>
    .list_tab {
        color: coral
    }

    #queryTable{}
    #queryTable tr{height:48px}
    #queryTable tr td{width:150px}
    .wd200{width:200px}
    .wd550{width:480px}
    #row{width: 960px;clear: both;margin: auto}
    .ml_50{margin-left: 50px}
    .ml_10{margin-left: 10px}
    .mt_10{margin-top: 10px}
    .ht_80{height: 180px}
    #flower_table{margin-left: 10px}
    #flower_table  tr{
        height: 40px;
    }

</style>
<div class="container-fluid">
<div class="row">
    <div class="col-sm-3 col-md-2 sidebar">
        <ul id="list_tab" class="nav nav-sidebar">
            <li class="active"><a href="#">设置管理 <span class="sr-only">(current)</span></a></li>
            <li><a href="#Stat_Nar"><span>分类管理</span></a></li>
            <li><a href="#User_Vistor"><span>广告管理</span></a></li>
            <li><a href="#Plug_Down"><span>宿主软件</span></a></li>
        </ul>

    </div>
</div>

<div id="list_select">

</div>



</div>

<div id="bannerBar" class="panel panel-primary" style="width:700px;height:300px;z-index:9999;display: none;">
    <div id="banner" class="panel-heading" style="cursor: move;clear: both;height: 40px; ">
        <h3 class="panel-title" style="float: left"></h3>
        <span id="queryBoxClose" class="badge" style="float: right;cursor:pointer">&times;</span>
    </div>
    <div id="panel-body" class="panel-body" data="">

    </div>
</div>

<div id="EventListen" style="display: none"></div>

<div id="add_host_app" style="display: none" width="700" height="300">
    <form id="add_host_app" class="form-signin">
        <table id="queryTable" class="ml_50" >
            <tr>
                <td>宿主名称：</td>
                <td><input id="text_hostApp" type="text"  class="form-control wd200" ></td>
                <td></td>
                <td>宿主包名：</td>
                <td><input id="text_hostApp_name" type="text"  class="form-control wd200"></td>
            </tr>
            <tr>
                <td>支持的版本</td>
                <td><input id="text_hostApp_version" type="text"  class="form-control wd200"></td>
                <td></td>
                <td>用分割符区分版本</td>
                <td>(比如：12;14;15;)</td>

            </tr>
            <tr class="ht_80">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><button class="btn btn-lg btn-primary btn-block" type="button">添加</button></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>

            </tr>

        </table>
    </form>
</form>
</div>
<%- include _footer %>

<script type="text/javascript">
    (function($){
        function fetchHostApp(){
            var url="/admin/layout_hostapp";
            $.my_ajax_html(url,'#list_select');
        }
        fetchHostApp();

        $("#list_select").delegate(".list_delete","click",function(){
            var flag=confirm('请您确认是否真的要删除!');
            if (flag){
                var dom=$(this).parent().parent().parent();
                var id=dom.attr('id');
                var table=dom.attr('table');
                var col_id=dom.attr('col_id');

                var url='/system/delete_table?col_id='+col_id+'&id='+id+"&table="+table;
                $.my_ajax_html(url,"");

                alert('该操作已执行,如果已存在数据表的级联关系,系统默认不会删除！');
                fetchHostApp();
            }
        });

        $("#list_select").delegate(".list_edit","click",function(){
            var width=$("#add_host_app").attr('width');
            var height=$("#add_host_app").attr('height');

            addBannerBar(width,height,"hostApp","#add_host_app",'编辑宿主软件');

            $("#text_hostApp").val($(this).attr("hostAppName"));
            $("#text_hostApp_name").val($(this).attr("hostPackageName"));
            $("#text_hostApp_version").val($(this).attr("own_version"));
        });


        $("#list_select").delegate(".list_add","click",function(){
            var width=$("#add_host_app").attr('width');
            var height=$("#add_host_app").attr('height');

            addBannerBar(width,height,"hostApp","#add_host_app",'添加宿主软件');
        });

        function addBannerBar(width,height,urlType,divTarget,topic){
            $("#bannerBar").attr('width',width);
            $("#bannerBar").attr('height',height);

            $("#panel-body").attr("data",urlType);
            $("#panel-body").html($(divTarget).html());

            $("#banner h3").text(topic);
            $("#bannerBar").show();
        }





        $("#panel-body").delegate("button","click",function(){
            var url=undefined;
            if ($("#panel-body").attr("data")=='hostApp'){
                url='/admin/add_host_app?'+$("#add_host_app").serialize();
            }
            
            $.my_ajax_html(url,"#EventListen");
        });


        $("#EventListen").bind('DOMNodeInserted',function(e){
           alert($(this).html());
        });

    })($);

</script>
