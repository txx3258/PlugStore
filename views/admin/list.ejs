<%- include _header %>

<link href="<%= staticResourceUrl %>/css/tablednd.css" rel="stylesheet">
<style>
    .list_tab{color: coral}
</style>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul id="list_tab" class="nav nav-sidebar">
                <li class="active"><a  href="#">榜单管理 <span class="sr-only">(current)</span></a></li>
                <li><a href="#list_select"><span class="list_tab">精选榜</span></a></li>
                <li><a href="#list_top"><span>排行榜</span></a></li>
                <li><a href="#list_type"><span>分类榜</span></a></li>
            </ul>

        </div>
    </div>
  <div id="list_select">
    <div class="col-sm-15 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div id="list_select_container" class="tableDemo" style="width: 890px">




        </div>


    </div>
  </div>

</div>

<div id="bannerBar" class="panel panel-primary" style="z-index:999;display: none" menu="choose">
    <div id="banner" class="panel-heading" style="cursor: move;clear: both;height: 40px; ">
        <h3 class="panel-title" style="float: left"></h3>
        <span id="queryBoxClose" class="badge" style="float: right;cursor:pointer">&times;</span>
    </div>
    <div id="panel-body" class="panel-body">

    </div>
</div>









<%- include _footer %>
<!--
<script src="<%= staticResourceUrl %>/js/jquery.tablednd.0.7.min.js"></script>  -->

<script src="/js/jquery.tablednd.js"></script>
<script type="text/javascript">
 (function($){
    function inline_sprintlist_ondrop(table, row) {
        var result = $(table).parent().find('.result'),
                pre = $('<pre class="prettyprint">');

        result.html(pre.text($.tableDnD.jsonize(true)));
    }
    $(document).ready(function () {
        $("#table-1").tableDnD();
        table_2 = $("#table-2");
        table_2.find("tr:even").addClass("alt");
        table_2.tableDnD({
            onDragClass: "myDragClass",
            onDrop: function (table, row) {
                var rows = table.tBodies[0].rows;
                var debugStr = "Row dropped was " + row.id + ". New order: ";
                for (var i = 0; i < rows.length; i++) {
                    debugStr += rows[i].id + " ";
                }
                $(table).parent().find('.result').text(debugStr);
            },
            onDragStart: function (table, row) {
                $(table).parent().find('.result').text("Started dragging row " + row.id);
            }
        });

    });

        $(".list_edit").click(function(){
            $("#bannerBar").show();
        });

        $("#queryBoxClose").click(function(){
            $("#bannerBar").hide();
        });

        function fetchList(type){
            var url="/admin/choose_list_app?type="+type;
            $.my_ajax_html(url,"#list_select_container");
        }


        $("#list_tab li a").click(function(){
            var href=$(this).attr('href');
            if(href.length>2){
                $(this).parent().parent().children().children().children().removeClass('list_tab');
                $(this).children().addClass('list_tab');

                if(href=="list_type"){
                    $("#list_type").show();
                    $("#list_select").hide();
                }else{
                    $("#list_type").hide();
                    $("#list_select").show();
                }

                var url=undefined;
                if (href=="#list_select"){
                    fetchList('1');
                    $("#bannerBar").attr("menu","choose");

                }else if (href=="#list_top"){
                    fetchList('2');
                    $("#bannerBar").attr("menu","top");
                }else{
                    $("#bannerBar").attr("menu","type");
                }

                return false;
            }
        });

        fetchList('1');

        $("#list_select").delegate(".list_delete","click",function(){
            var flag=confirm('请您确认是否真的要删除!');
            if (flag){
                var dom=$(this);
                var id=dom.attr('id');
                var table=dom.attr('table');
                var col_id="id";

                var url='/system/delete_table?col_id='+col_id+'&id='+id+"&table="+table;
                $.my_ajax_html(url,"");

                alert('该操作已执行,如果已存在数据表的级联关系,系统默认不会删除！');
                var menu=$("#bannerBar").attr("menu");
                if (menu=='choose'){
                    fetchList('1');
                }else if(menu=='top'){
                    fetchList('2');
                }else if(menu=='type'){

                }

            }
        });

        $("#list_select").delegate(".list_add","click",function(){
            var divId=$(this).attr("divID");
            var title=$(this).attr("title");

//            var width=$('#'+divId).attr('width');
//            var height=$('#'+divId).attr('height');

            var url="/admin/choose_list_app_add?type=0&ejsView=list_choose_app.ejs";
            $.my_ajax_html(url,"#panel-body");


            $("#bannerBar").center();
            $("#banner h3").text(title);
            $("#bannerBar").show();
            $("#bannerBar").center();
            //addBannerBar(width,height,divId,name,"add");
        });

        function addBannerBar(width,height,divTarget,topic,type){
            $("#bannerBar").attr('width',width);
            $("#bannerBar").attr('height',height);
            $("#bannerBar").attr('type',type);

            $("#panel-body").attr("data",divTarget);

            var html=$('#'+divTarget).html().replace(/replace_.*?_form/,divTarget+'_form');
            $("#panel-body").html(html);

            $("#banner h3").text(topic);
            $("#bannerBar").show();
            $("#bannerBar").center();
        }

        $("#panel-body").delegate("button","click",function(){
            var url=undefined;

            var menu=$("#bannerBar").attr("menu"),
               uid=$("#uid_forms").serialize();


            if (menu=='choose'){
                url='/admin/add_list_app?type=1&'+uid;
                $.my_ajax_alert(url,"/admin/choose_list_app?type=1",'#list_select_container');
            }else if(menu=='top'){
                url='/admin/add_list_app?type=2&'+uid;
                $.my_ajax_alert(url,"/admin/choose_list_app?type=2",'#list_select_container');
            }else if(menu=='type'){
                url='/admin/add_type_app?'+uid;
                $.my_ajax_alert(url,"/admin/app_type_root",'#list_select_container');
            }
        });

    })($);

</script>